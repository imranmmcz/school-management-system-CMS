<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>শিক্ষার্থী ব্যবস্থাপনা - পাঠশালা ই-ম্যানেজার</title>
    
    <!-- Google Fonts for Bengali -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Main Styles -->
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <!-- ==================== ADMIN PANEL ==================== -->
    <div class="admin-layout">
        <!-- Admin Sidebar -->
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <a href="admin-dashboard.html">
                    <img src="../assets/logo.png" alt="Logo">
                </a>
                <div class="sidebar-title">
                    <h3>অ্যাডমিন প্যানেল</h3>
                    <p>পাঠশালা ই-ম্যানেজার</p>
                </div>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li>
                        <a href="admin-dashboard.html">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>ড্যাশবোর্ড</span>
                        </a>
                    </li>
                    <li class="active">
                        <a href="admin-students.html">
                            <i class="fas fa-user-graduate"></i>
                            <span>শিক্ষার্থী</span>
                        </a>
                    </li>
                    <li>
                        <a href="admin-teachers.html">
                            <i class="fas fa-chalkboard-teacher"></i>
                            <span>শিক্ষক</span>
                        </a>
                    </li>
                    <li>
                        <a href="admin-attendance.html">
                            <i class="fas fa-calendar-check"></i>
                            <span>উপস্থিতি</span>
                        </a>
                    </li>
                    <li>
                        <a href="admin-fees.html">
                            <i class="fas fa-money-bill-wave"></i>
                            <span>ফি ম্যানেজমেন্ট</span>
                        </a>
                    </li>
                    <li>
                        <a href="admin-exams.html">
                            <i class="fas fa-clipboard-list"></i>
                            <span>পরীক্ষা</span>
                        </a>
                    </li>
                    <li>
                        <a href="admin-results.html">
                            <i class="fas fa-chart-line"></i>
                            <span>ফলাফল</span>
                        </a>
                    </li>
                    <li>
                        <a href="admin-payments.html">
                            <i class="fas fa-credit-card"></i>
                            <span>পেমেন্ট</span>
                        </a>
                    </li>
                    <li>
                        <a href="admin-notifications.html">
                            <i class="fas fa-bell"></i>
                            <span>নোটিফিকেশন</span>
                        </a>
                    </li>
                    <li>
                        <a href="admin-settings.html">
                            <i class="fas fa-cogs"></i>
                            <span>সেটিংস</span>
                        </a>
                    </li>
                    <li class="logout-item">
                        <a href="../index.html">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>লগআউট</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Admin Main Content -->
        <main class="admin-main">
            <!-- Top Bar -->
            <div class="admin-topbar">
                <button class="sidebar-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="breadcrumb">
                    <a href="admin-dashboard.html">ড্যাশবোর্ড</a>
                    <span><i class="fas fa-chevron-left"></i></span>
                    <span>শিক্ষার্থী</span>
                </div>
                <div class="admin-actions">
                    <button class="notification-btn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-count">৩</span>
                    </button>
                    <div class="admin-profile">
                        <img src="assets/logo.png" alt="Admin">
                        <span>অ্যাডমিন</span>
                    </div>
                </div>
            </div>

            <!-- Students Content -->
            <div class="module-content">
                <!-- Page Header -->
                <div class="page-header">
                    <div class="page-title">
                        <h2><i class="fas fa-user-graduate"></i> শিক্ষার্থী ব্যবস্থাপনা</h2>
                        <p>সমস্ত শিক্ষার্থীর তথ্য এবং পরিচালনা</p>
                    </div>
                    <button class="btn-primary" onclick="openModal('add-student-modal')">
                        <i class="fas fa-plus"></i> নতুন শিক্ষার্থী যোগ করুন
                    </button>
                </div>

                <!-- Filter Section -->
                <div class="filter-section">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="student-search" placeholder="শিক্ষার্থী খুঁজুন (নাম, আইডি)..." onkeyup="searchStudents()">
                    </div>
                    <div class="filter-group">
                        <select id="class-filter" onchange="filterByClass()">
                            <option value="">সব শ্রেণি</option>
                            <option value="1">৬ষ্ঠ শ্রেণি</option>
                            <option value="2">৭ম শ্রেণি</option>
                            <option value="3">৮ম শ্রেণি</option>
                            <option value="4">৯ম শ্রেণি</option>
                            <option value="5">১০ম শ্রেণি</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <select id="status-filter" onchange="filterByStatus()">
                            <option value="">সব স্ট্যাটাস</option>
                            <option value="active">সক্রিয়</option>
                            <option value="inactive">নিষ্ক্রিয়</option>
                        </select>
                    </div>
                </div>

                <!-- Students Table -->
                <div class="data-table-container">
                    <table class="data-table" id="students-table">
                        <thead>
                            <tr>
                                <th>ছবি</th>
                                <th>আইডি</th>
                                <th>নাম</th>
                                <th>শ্রেণি</th>
                                <th>রোল</th>
                                <th>মোবাইল</th>
                                <th>অভিভাবক</th>
                                <th>স্ট্যাটাস</th>
                                <th>অ্যাকশন</th>
                            </tr>
                        </thead>
                        <tbody id="students-table-body">
                            <!-- Students will be rendered here -->
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination">
                    <button class="page-btn active">১</button>
                    <button class="page-btn">২</button>
                    <button class="page-btn">৩</button>
                    <button class="page-btn next"><i class="fas fa-chevron-left"></i></button>
                </div>
            </div>
        </main>
    </div>

    <!-- ==================== MODALS ==================== -->

    <!-- Add Student Modal -->
    <div id="add-student-modal" class="modal-overlay">
        <div class="modal large">
            <div class="modal-header">
                <h3><i class="fas fa-user-plus"></i> নতুন শিক্ষার্থী যোগ করুন</h3>
                <button class="modal-close" onclick="closeModal('add-student-modal')">&times;</button>
            </div>
            <form id="add-student-form" class="modal-body">
                <div class="form-section">
                    <h4>ব্যক্তিগত তথ্য</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>শিক্ষার্থীর নাম *</label>
                            <input type="text" id="student-name" required placeholder="বাংলায় পূর্ণ নাম">
                        </div>
                        <div class="form-group">
                            <label>জন্ম তারিখ *</label>
                            <input type="date" id="student-dob" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>লিঙ্গ *</label>
                            <select id="student-gender" required>
                                <option value="">নির্বাচন করুন</option>
                                <option value="male">ছেলে</option>
                                <option value="female">মেয়ে</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ধর্ম *</label>
                            <select id="student-religion" required>
                                <option value="islam">ইসলাম</option>
                                <option value="hindu">হিন্দু</option>
                                <option value="christian">খ্রিস্টান</option>
                                <option value="buddhist">বৌদ্ধ</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>রক্তের গ্রুপ</label>
                            <select id="student-blood">
                                <option value="">নির্বাচন করুন</option>
                                <option value="A+">A+</option>
                                <option value="A-">A-</option>
                                <option value="B+">B+</option>
                                <option value="B-">B-</option>
                                <option value="O+">O+</option>
                                <option value="O-">O-</option>
                                <option value="AB+">AB+</option>
                                <option value="AB-">AB-</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ছবি</label>
                            <input type="file" id="student-photo" accept="image/*">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h4>একাডেমিক তথ্য</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>শ্রেণি *</label>
                            <select id="student-class" required>
                                <option value="">নির্বাচন করুন</option>
                                <option value="1">৬ষ্ঠ শ্রেণি</option>
                                <option value="2">৭ম শ্রেণি</option>
                                <option value="3">৮ম শ্রেণি</option>
                                <option value="4">৯ম শ্রেণি</option>
                                <option value="5">১০ম শ্রেণি</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>শাখা</label>
                            <select id="student-section">
                                <option value="ক">ক</option>
                                <option value="খ">খ</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>রোল নম্বর</label>
                            <input type="number" id="student-roll" placeholder="রোল নম্বর">
                        </div>
                        <div class="form-group">
                            <label>ভর্তির তারিখ</label>
                            <input type="date" id="admission-date">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h4>যোগাযোগ তথ্য</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>মোবাইল নম্বর</label>
                            <input type="tel" id="student-phone" placeholder="+৮৮০১৭XXXXXXXX">
                        </div>
                        <div class="form-group">
                            <label>ইমেইল</label>
                            <input type="email" id="student-email" placeholder="email@example.com">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h4>অভিভাবকের তথ্য</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>বাবার নাম *</label>
                            <input type="text" id="father-name" required placeholder="বাবার নাম">
                        </div>
                        <div class="form-group">
                            <label>বাবার ফোন *</label>
                            <input type="tel" id="father-phone" required placeholder="+৮৮০১৭XXXXXXXX">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>মায়ের নাম</label>
                            <input type="text" id="mother-name" placeholder="মায়ের নাম">
                        </div>
                        <div class="form-group">
                            <label>ঠিকানা</label>
                            <textarea id="student-address" rows="2" placeholder="সম্পূর্ণ ঠিকানা"></textarea>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeModal('add-student-modal')">বাতিল</button>
                    <button type="submit" class="btn-primary"><i class="fas fa-save"></i> সেভ করুন</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Student Modal -->
    <div id="view-student-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-user"></i> শিক্ষার্থীর বিস্তারিত</h3>
                <button class="modal-close" onclick="closeModal('view-student-modal')">&times;</button>
            </div>
            <div class="modal-body" id="student-details">
                <!-- Student details will be rendered here -->
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast-container"></div>

    <!-- Scripts -->
    <script src="../js/storage.js"></script>
    <script src="../js/app.js"></script>
    <script>
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            StorageManager.init();
            renderStudents();
        });

        // Render students table
        function renderStudents() {
            const students = StorageManager.getStudents();
            const tbody = document.getElementById('students-table-body');
            
            tbody.innerHTML = students.map(student => {
                const classObj = StorageManager.getClassById(student.classId);
                return `
                    <tr>
                        <td>
                            <img src="${student.image || 'assets/logo.png'}" alt="${student.banglaName}" class="student-thumbnail">
                        </td>
                        <td>${student.studentId}</td>
                        <td>${student.banglaName}</td>
                        <td>${classObj ? classObj.name : '-'}</td>
                        <td>${student.rollNumber}</td>
                        <td>${student.phone || '-'}</td>
                        <td>${student.fatherName}</td>
                        <td>
                            <span class="status-badge ${student.status === 'active' ? 'status-active' : 'status-inactive'}">
                                ${student.status === 'active' ? 'সক্রিয়' : 'নিষ্ক্রিয়'}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-icon" title="দেখুন" onclick="viewStudent(${student.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-icon" title="সম্পাদনা" onclick="editStudent(${student.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-icon" title="আইডি কার্ড" onclick="viewIDCard(${student.id})">
                                    <i class="fas fa-id-card"></i>
                                </button>
                                <button class="btn-icon danger" title="মুছুন" onclick="deleteStudent(${student.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // View student details
        function viewStudent(id) {
            const student = StorageManager.getStudentById(id);
            if (!student) return;

            const classObj = StorageManager.getClassById(student.classId);
            const feeSummary = StorageManager.getStudentFeeSummary(id);

            document.getElementById('student-details').innerHTML = `
                <div class="student-profile">
                    <img src="${student.image || 'assets/logo.png'}" alt="${student.banglaName}" class="profile-image-large">
                    <h3>${student.banglaName}</h3>
                    <p>আইডি: ${student.studentId}</p>
                    <span class="status-badge ${student.status === 'active' ? 'status-active' : 'status-inactive'}">
                        ${student.status === 'active' ? 'সক্রিয়' : 'নিষ্ক্রিয়'}
                    </span>
                </div>
                <div class="profile-details">
                    <div class="detail-row">
                        <span class="label">শ্রেণি:</span>
                        <span class="value">${classObj ? classObj.name : '-'}</span>
                    </div>
                    <div class="detail-row">
                        <span class="label">রোল:</span>
                        <span class="value">${student.rollNumber}</span>
                    </div>
                    <div class="detail-row">
                        <span class="label">জন্ম তারিখ:</span>
                        <span class="value">${student.dateOfBirth}</span>
                    </div>
                    <div class="detail-row">
                        <span class="label">ধর্ম:</span>
                        <span class="value">${student.religion}</span>
                    </div>
                    <div class="detail-row">
                        <span class="label">মোবাইল:</span>
                        <span class="value">${student.phone || '-'}</span>
                    </div>
                    <div class="detail-row">
                        <span class="label">বাবার নাম:</span>
                        <span class="value">${student.fatherName}</span>
                    </div>
                    <div class="detail-row">
                        <span class="label">বাবার ফোন:</span>
                        <span class="value">${student.fatherPhone}</span>
                    </div>
                    <div class="detail-row">
                        <span class="label">ঠিকানা:</span>
                        <span class="value">${student.address || '-'}</span>
                    </div>
                    <div class="fee-summary-box">
                        <h4>ফি সারসংক্ষেপ</h4>
                        <p>মোট: ${AdminManager.formatCurrency(feeSummary.total)}</p>
                        <p>পরিশোধিত: ${AdminManager.formatCurrency(feeSummary.paid)}</p>
                        <p>বকেয়া: ${AdminManager.formatCurrency(feeSummary.due)}</p>
                    </div>
                </div>
            `;

            openModal('view-student-modal');
        }

        // Edit student
        function editStudent(id) {
            showToast('সম্পাদনা মোডাল শীঘ্রই আসছে', 'info');
        }

        // Delete student
        function deleteStudent(id) {
            if (confirm('এই শিক্ষার্থী মুছে ফেলতে চান?')) {
                StorageManager.deleteStudent(id);
                renderStudents();
                showToast('শিক্ষার্থী মুছে ফেলা হয়েছে', 'success');
            }
        }

        // View ID Card
        function viewIDCard(id) {
            const student = StorageManager.getStudentById(id);
            if (!student) return;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>আইডি কার্ড - ${student.banglaName}</title>
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { font-family: 'Hind Siliguri', sans-serif; padding: 20px; background: #f0f0f0; }
                        .id-card {
                            width: 350px;
                            background: white;
                            border-radius: 15px;
                            overflow: hidden;
                            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                            margin: 0 auto 20px;
                        }
                        .card-header {
                            background: linear-gradient(135deg, #00695C, #004D40);
                            color: white;
                            padding: 20px;
                            text-align: center;
                        }
                        .card-header img { width: 60px; height: 60px; border-radius: 50%; background: white; padding: 5px; margin-bottom: 10px; }
                        .card-header h2 { font-size: 1.2rem; margin-bottom: 5px; }
                        .card-header p { font-size: 0.8rem; opacity: 0.9; }
                        .card-body { padding: 20px; text-align: center; }
                        .card-body img { width: 100px; height: 100px; border-radius: 10px; object-fit: cover; border: 3px solid #00695C; margin-bottom: 15px; }
                        .card-body h3 { margin-bottom: 5px; color: #1a1a2e; }
                        .card-info { text-align: right; font-size: 0.85rem; color: #4b5563; }
                        .card-info p { padding: 5px 0; border-bottom: 1px dashed #e5e7eb; }
                        .card-footer { background: #00695C; color: white; padding: 10px; text-align: center; font-size: 0.7rem; }
                        @media print {
                            body { background: white; }
                            .id-card { box-shadow: none; border: 2px solid #00695C; }
                        }
                    </style>
                </head>
                <body>
                    <div class="id-card">
                        <div class="card-header">
                            <img src="assets/logo.png" alt="Logo">
                            <h2>পাঠশালা ই-ম্যানেজার</h2>
                            <p>ছাত্র/ছাত্রী পরিচয়পত্র</p>
                        </div>
                        <div class="card-body">
                            <img src="${student.image || 'assets/logo.png'}" alt="${student.banglaName}">
                            <h3>${student.banglaName}</h3>
                            <div class="card-info">
                                <p>আইডি: ${student.studentId}</p>
                                <p>শ্রেণি: ${StorageManager.getClassById(student.classId)?.name || '-'}</p>
                                <p>রোল: ${student.rollNumber}</p>
                                <p>ফোন: ${student.phone || '-'}</p>
                                <p>অভিভাবক: ${student.fatherName}</p>
                            </div>
                        </div>
                        <div class="card-footer">
                            ১২৩, শিক্ষা রোড, ঢাকা-১০০০ | ফোন: +৮৮০১২৩৪৫৬৭৮৯০
                        </div>
                    </div>
                    <script>window.print();<\/script>
                </body>
                </html>
            `);
        }

        // Search students
        function searchStudents() {
            const query = document.getElementById('student-search').value.toLowerCase();
            const students = StorageManager.getStudents();
            
            const filtered = students.filter(s => 
                s.banglaName.toLowerCase().includes(query) ||
                s.studentId.toLowerCase().includes(query) ||
                s.fatherName.toLowerCase().includes(query)
            );
            
            renderFilteredStudents(filtered);
        }

        // Filter by class
        function filterByClass() {
            const classId = document.getElementById('class-filter').value;
            if (classId) {
                const students = StorageManager.getStudentsByClass(parseInt(classId));
                renderFilteredStudents(students);
            } else {
                renderStudents();
            }
        }

        // Render filtered students
        function renderFilteredStudents(students) {
            const tbody = document.getElementById('students-table-body');
            
            if (students.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="empty-state">কোনো শিক্ষার্থী পাওয়া যায়নি</td></tr>';
                return;
            }
            
            tbody.innerHTML = students.map(student => {
                const classObj = StorageManager.getClassById(student.classId);
                return `
                    <tr>
                        <td><img src="${student.image || 'assets/logo.png'}" alt="${student.banglaName}" class="student-thumbnail"></td>
                        <td>${student.studentId}</td>
                        <td>${student.banglaName}</td>
                        <td>${classObj ? classObj.name : '-'}</td>
                        <td>${student.rollNumber}</td>
                        <td>${student.phone || '-'}</td>
                        <td>${student.fatherName}</td>
                        <td><span class="status-badge ${student.status === 'active' ? 'status-active' : 'status-inactive'}">${student.status === 'active' ? 'সক্রিয়' : 'নিষ্ক্রিয়'}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-icon" title="দেখুন" onclick="viewStudent(${student.id})"><i class="fas fa-eye"></i></button>
                                <button class="btn-icon" title="সম্পাদনা" onclick="editStudent(${student.id})"><i class="fas fa-edit"></i></button>
                                <button class="btn-icon" title="আইডি কার্ড" onclick="viewIDCard(${student.id})"><i class="fas fa-id-card"></i></button>
                                <button class="btn-icon danger" title="মুছুন" onclick="deleteStudent(${student.id})"><i class="fas fa-trash"></i></button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Form submission
        document.getElementById('add-student-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const studentData = {
                firstName: document.getElementById('student-name').value.split(' ')[0],
                lastName: document.getElementById('student-name').value.split(' ').slice(1).join(' ') || '',
                banglaName: document.getElementById('student-name').value,
                gender: document.getElementById('student-gender').value,
                dateOfBirth: document.getElementById('student-dob').value,
                religion: document.getElementById('student-religion').value,
                bloodGroup: document.getElementById('student-blood').value,
                phone: document.getElementById('student-phone').value,
                email: document.getElementById('student-email').value,
                classId: parseInt(document.getElementById('student-class').value),
                section: document.getElementById('student-section').value,
                rollNumber: parseInt(document.getElementById('student-roll').value) || 0,
                admissionDate: document.getElementById('admission-date').value,
                fatherName: document.getElementById('father-name').value,
                fatherPhone: document.getElementById('father-phone').value,
                motherName: document.getElementById('mother-name').value,
                address: document.getElementById('student-address').value
            };

            StorageManager.addStudent(studentData);
            closeModal('add-student-modal');
            renderStudents();
            this.reset();
            showToast('শিক্ষার্থী যোগ করা হয়েছে', 'success');
        });

        // Toggle sidebar
        function toggleSidebar() {
            document.querySelector('.admin-sidebar').classList.toggle('collapsed');
            document.querySelector('.admin-main').classList.toggle('expanded');
        }
    </script>
</body>
</html>
